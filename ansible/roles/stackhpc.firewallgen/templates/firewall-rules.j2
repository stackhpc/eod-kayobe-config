#jinja2: trim_blocks: "false", lstrip_blocks: "false"

*security
:INPUT ACCEPT
:FORWARD ACCEPT
:OUTPUT ACCEPT
COMMIT

*raw
:PREROUTING ACCEPT
:OUTPUT ACCEPT
COMMIT

*mangle
:PREROUTING ACCEPT
:INPUT ACCEPT
:FORWARD ACCEPT
:OUTPUT ACCEPT
:POSTROUTING ACCEPT
COMMIT

*nat
:PREROUTING ACCEPT
:INPUT ACCEPT
:OUTPUT ACCEPT
:POSTROUTING ACCEPT
COMMIT

*filter
:INPUT DROP
:FORWARD DROP
:OUTPUT ACCEPT
:TCP -
:UDP -
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -m comment --comment "FIREWALLGEN"
-A INPUT -i lo -j ACCEPT -m comment --comment "FIREWALLGEN"
-A INPUT -m conntrack --ctstate INVALID -j DROP -m comment --comment "FIREWALLGEN"
{% if firewallgen_iptables_version == 4 %}
-A INPUT -p icmp -m icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT -m comment --comment "FIREWALLGEN"
{% else %}
-A INPUT -p ipv6-icmp --icmpv6-type 128 -m conntrack --ctstate NEW -j ACCEPT -m comment --comment "FIREWALLGEN"
{% endif %}
-A INPUT -p udp -m conntrack --ctstate NEW -j UDP -m comment --comment "FIREWALLGEN"
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j TCP -m comment --comment "FIREWALLGEN"
{% if firewallgen_iptables_version == 4 %}
-A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable -m comment --comment "FIREWALLGEN"
{% else %}
-A INPUT -p udp -j REJECT --reject-with icmp6-adm-prohibited -m comment --comment "FIREWALLGEN"
{% endif %}
-A INPUT -p tcp -j REJECT --reject-with tcp-reset -m comment --comment "FIREWALLGEN"
{% if firewallgen_iptables_version == 4 %}
-A INPUT -j REJECT --reject-with icmp-proto-unreachable -m comment --comment "FIREWALLGEN"
{% else %}
-A INPUT -j REJECT --reject-with icmp6-adm-prohibited -m comment --comment "FIREWALLGEN"
{% endif %}
{% set firewallgen_rules =  firewallgen_ipv4_input_allow_rules if firewallgen_iptables_version == 4 else firewallgen_ipv6_input_allow_rules %}
{%+ for rule in firewallgen_rules %}
{% if rule.proto == "tcp" %}
-A TCP -p tcp -m tcp --dport {{ rule.port }} -j ACCEPT{% if rule.interface | default(False) and rule.interface != "all" %} -i {{ rule.interface }}{% endif %}{% if rule.destination | default(False) %} -d {{ rule.destination }}{% endif %} -m comment --comment "{{ "FIREWALLGEN" ~ (': ' if rule.comment else '') ~ (rule.comment | default('')) }}"
{% endif %}
{% if rule.proto == "udp" %}
-A UDP -p udp -m udp --dport {{ rule.port }} -j ACCEPT{% if rule.interface | default(False) and rule.interface != "all" %} -i {{ rule.interface }}{% endif %}{% if rule.destination | default(False) %} -d {{ rule.destination }}{% endif %} -m comment --comment "{{ "FIREWALLGEN" ~ (': ' if rule.comment else '') ~ (rule.comment | default('')) }}"
{% endif %}

{% endfor %}
COMMIT
